<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form Input dan Tabel dengan Firebase</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>

    <style>
        #inputForm {
            display: none;
        }



    </style>
</head>
<body>
    <div class="container mt-5">
        <div class="d-flex justify-content-between">
            <h2>Daftar Mahasiswa</h2>
            <button onclick="showFormBtn()" class="btn btn-primary">
                <i class="fas fa-plus"></i> Tambah Data
            </button>
        </div>
        
        <form id="inputForm" class="mt-3">
            <div class="form-group">
                <label for="nama">Nama</label>
                <input type="text" class="form-control" id="nama" placeholder="Masukkan Nama">
            </div>
            <div class="form-group">
                <label for="alamat">Alamat</label>
                <input type="text" class="form-control" id="alamat" placeholder="Masukkan Alamat">
            </div>
            <div class="form-group">
                <label for="jurusan">Jurusan</label>
                <input type="text" class="form-control" id="jurusan" placeholder="Masukkan Jurusan">
            </div>
            <button type="button" class="btn btn-success" onclick="addDataBtn()">Tambah</button>
            <button type="button" class="btn btn-secondary" onclick="closeFormBtn()">Tutup</button>
        </form>

        <table class="table table-bordered mt-3" id="dataTable">
            <thead>
                <tr>
                    <th>No</th>
                    <th>Nama</th>
                    <th>Alamat</th>
                    <th>Jurusan</th>
                </tr>
            </thead>
            <tbody id="databody">
                <!-- Data akan ditambahkan di sini -->
            </tbody>
        </table>
    </div>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://kit.fontawesome.com/a076d05399.js"></script>
    <script>
    // Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyD4JmeKXkgSAqalQorw3_VJcLd1FZPFdjk",
        authDomain: "datasiswa-620fb.firebaseapp.com",
        databaseURL: "https://datasiswa-620fb-default-rtdb.firebaseio.com",
        projectId: "datasiswa-620fb",
        storageBucket: "datasiswa-620fb.appspot.com",
        messagingSenderId: "279773747322",
        appId: "1:279773747322:web:f8a0b34a5cfd072b7303c3",
        measurementId: "G-GC3MPH0DQP"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);

    let count = 0;

    // Fungsi untuk menambahkan data ke tabel
    function addToTable(data, index) {
        // Buat elemen baris baru
        const tr = document.createElement('tr');

        // Tambah nomor urut
        const tdNo = document.createElement('td');
        tdNo.textContent = index;
        tr.appendChild(tdNo);

        // Buat dan tambahkan kolom untuk nama
        const tdNama = document.createElement('td');
        tdNama.textContent = data.nama;
        tr.appendChild(tdNama);

        // Buat dan tambahkan kolom untuk alamat
        const tdAlamat = document.createElement('td');
        tdAlamat.textContent = data.alamat;
        tr.appendChild(tdAlamat);

        // Buat dan tambahkan kolom untuk jurusan
        const tdJurusan = document.createElement('td');
        tdJurusan.textContent = data.jurusan;
        tr.appendChild(tdJurusan);

        // Tambahkan baris ke tbody
        document.getElementById('databody').appendChild(tr);
    }

    // Fungsi untuk menambahkan data baru
    function addDataBtn() {
        // Ambil nilai input
        const nama = document.getElementById('nama').value;
        const alamat = document.getElementById('alamat').value;
        const jurusan = document.getElementById('jurusan').value;

        // Periksa jika input kosong
        if (!nama || !alamat || !jurusan) {
            alert('Semua field harus diisi!');
            return;
        }

        // Buat objek data
        const data = {
            nama: nama,
            alamat: alamat,
            jurusan: jurusan
        };

        // Ambil count dari Firebase dan tambahkan data baru
        firebase.database().ref('siswa').once('value', function(snapshot) {
            const dataCount = snapshot.numChildren();
            const newIndex = dataCount + 1;

            // Simpan data ke Firebase
            firebase.database().ref('siswa/' + newIndex).set(data, function(error) {
                if (error) {
                    alert('Data tidak berhasil disimpan: ' + error.message);
                } else {
                    // Data berhasil disimpan, tambahkan ke tabel
                    addToTable(data, newIndex);
                }
            });

            // Bersihkan form input setelah data ditambahkan
            document.getElementById('inputForm').reset();
        });
    }

    // Fungsi untuk menutup form input
    function closeFormBtn() {
        document.getElementById('inputForm').style.display = 'none';
    }

    // Fungsi untuk menampilkan form input kembali
    function showFormBtn() {
        document.getElementById('inputForm').style.display = 'block';
    }

    // Membaca data dari Firebase dan menambahkannya ke tabel
    function fetchData() {
        const databaseRef = firebase.database().ref('siswa');
        databaseRef.once('value', function(snapshot) {
            snapshot.forEach(function(childSnapshot) {
                const data = childSnapshot.val();
                const index = childSnapshot.key;
                addToTable(data, index);
            });
        });
    }

    // Panggil fetchData untuk membaca dan menampilkan data saat halaman dimuat
    window.onload = fetchData;

</script>
</body>
</html>
